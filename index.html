<!DOCTYPE html>
<html>
    <head>
        <style>
            /* Button Base Style */
            .btn {
                display: inline-block;
                padding: 0.5rem 1rem; /* Tailwind's px-4 py-2 */
                font-size: 1rem; /* Tailwind's text-base */
                color: #fff;
                background-color: #3b82f6; /* Tailwind's bg-blue-500 */
                border: none;
                border-radius: 0.25rem; /* Tailwind's rounded-md */
                cursor: pointer;
                transition: background-color 0.2s, box-shadow 0.2s;
                max-width:6rem;
                text-align: center;

                margin: 0 auto;

            }
    
            /* Hover State */
            .btn:hover {
                background-color: #2563eb; /* Tailwind's bg-blue-600 */
            }
    
            /* Focus State */
            .btn:focus {
                outline: 4px solid #bfdbfe; /* Tailwind's ring and ring-blue-300 */
                outline-offset: 2px;
            }
    
            /* Active State */
            .btn:active {
                background-color: #1d4ed8; /* Tailwind's bg-blue-700 */
                box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);
            }
            .form-container {
                display: flex;
                flex-direction: row;
                margin-bottom: 2rem;
            }
        </style>
    </head>
<body>

<form class="form-container">
<input type="file" id="uploadImage" accept="image/*">
<a id="downloadLink" class="btn" style="display:none;">Download</a>
</form>

<canvas id="canvas" style="border:1px solid #000;"></canvas>

<script>
document.getElementById('uploadImage').addEventListener('change', function(e) {
    const reader = new FileReader();
    reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
            const masthead = new Image();
            masthead.onload = function() {
                const canvas = document.getElementById('canvas');
                const ctx = canvas.getContext('2d');
                
                // Adjust canvas size to match masthead width and dynamically calculated height
                canvas.width = masthead.width;
                canvas.height = masthead.height + img.height + 48; // Extra 48px for top and bottom margins

                // Draw masthead
                ctx.drawImage(masthead, 0, 0, masthead.width, masthead.height);

                // Calculate content area dimensions
                const contentX = 24; // margin left
                const contentWidth = masthead.width - 24 - 60; // masthead width - marginLeft - marginRight
                const contentY = masthead.height + 24; // masthead height + marginTop
                const contentHeight = img.height; // initial height before adjustment
                
                // Draw rounded rectangle for content area
                drawRoundedRect(ctx, contentX, contentY, contentWidth, contentHeight + 24, 20); // 20px corner radius
                
                // Draw the image inside the rounded rectangle
                // Adjust image size and position if necessary
                ctx.drawImage(img, contentX, contentY, contentWidth, contentHeight);

                // Function to draw a rounded rectangle
                function drawRoundedRect(ctx, x, y, width, height, radius) {
                    ctx.beginPath();
                    ctx.moveTo(x + radius, y);
                    ctx.lineTo(x + width - radius, y);
                    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
                    ctx.lineTo(x + width, y + height - radius);
                    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                    ctx.lineTo(x + radius, y + height);
                    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
                    ctx.lineTo(x, y + radius);
                    ctx.quadraticCurveTo(x, y, x + radius, y);
                    ctx.closePath();
                    ctx.clip(); // Clip to the rounded rectangle shape
                }

                // Prepare for download
                document.getElementById('downloadLink').href = canvas.toDataURL('image/png');
                document.getElementById('downloadLink').download = 'combined-image.png';
                document.getElementById('downloadLink').style.display = 'block';
            };
            masthead.src = 'frames/masthead1.jpg'; // Path to the masthead
        };
        img.src = event.target.result;
    };
    reader.readAsDataURL(e.target.files[0]);
});

document.getElementById('downloadLink').addEventListener('click', function() {
    this.style.display = 'none';
});
</script>

</body>
</html>
